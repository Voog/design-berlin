!function(o){function t(t,s){this.$el=t,this.options=o.extend({},e,s),this.init()}var e={lang:"en",resultTpl:'<div class="voog-search-result"><h3 class="voog-search-result-title"><a class="voog-search-result-link" href="[[url]]">[[title]]</a></h3><p class="voog-search-result-content">[[content]]</p></div>',modalTpl:'<div class="voog-search-container"><div class="voog-search-inner"><div class="voog-search-results"></div><div class="voog-search-noresults"></div><div class="voog-search-loader"></div></div></div>',noResults:"No results found!",minChars:3,$parent:o("body"),closeOnSideClick:!0};t.prototype={init:function(){this.$input=this.$el.find('input[type="search"], input[type="text"]'),this.$modal=this.createModal(),this.$content=this.$modal.find(".voog-search-inner"),this.$loader=this.$modal.find(".voog-search-loader"),this.$results=this.$modal.find(".voog-search-results"),this.$noresults=this.$modal.find(".voog-search-noresults"),this.$clearbtn=this.$el.find(".js-search-close"),this.searcher=new VoogSearchSDK(this.filterParams(this.options),o.proxy(this.handleSearchResult,this)),this.$el.on("submit",o.proxy(this.handleSubmit,this)),this.$input.on("keyup",o.proxy(this.handleInputKeyup,this)),this.$input.on("focus",o.proxy(this.handleInputFocus,this)),this.$input.on("blur",o.proxy(this.handleInputBlur,this)),this.$clearbtn.on("click",o.proxy(this.handleClearButtonClick,this)),this.$content.on("scroll",o.proxy(this.handleModalScroll,this))},createModal:function(){var t=o(this.options.modalTpl);return t.appendTo(this.options.$parent),t},filterParams:function(t){for(var s=["per_page","page","lang","q","types","tags","path","tag_facets"],e={},i=s.length;i--;)void 0!==t[s[i]]&&(e[s[i]]=t[s[i]]);return e},handleSubmit:function(t){t.preventDefault();var s=this.$input.data("oldValue")||"",t=this.$input.val();return t!=s&&t.length>=this.options.minChars&&(this.$input.data("oldValue",t),this.doSearch()),!1},handleInputKeyup:function(t){var s,e;this.options.searchOnType&&(s=this.$input.data("oldValue")||"",(e=this.$input.val())!=s&&e.length>=this.options.minChars&&(this.$input.data("oldValue",e),this.doSearch()))},handleInputFocus:function(){this.$el.find(".search-box").addClass("search-box-focus")},handleInputBlur:function(){var t=this.options.visibleClass||"voog-search-visible";o("body").hasClass(t)||this.$el.find(".search-box").removeClass("search-box-focus")},handleSideClick:function(t){o.contains(this.$modal.get(0),t.target)||t.target===this.$modal.get(0)||t.target===this.$input.get(0)||this.reset()},handleClearButtonClick:function(t){t.preventDefault(),this.reset()},handleModalScroll:function(t){var s=this.$content.scrollTop();maxy=this.$content.get(0).scrollHeight-this.$content.get(0).offsetHeight,treshold=10,s>=maxy-10&&!this.loading_active&&this.pageLinks&&this.pageLinks.page<this.pageLinks.total&&this.fetchNextPage()},doSearch:function(){clearTimeout(this.timeout),this.timeout=setTimeout(o.proxy(function(){var t=!0,s=this.$input.val(),e=this.options.visibleClass||"voog-search-visible";o("body").hasClass(e)||(o("body").addClass(e),this.options.closeOnSideClick&&o(document).on("click.voog-search-sideclick",o.proxy(this.handleSideClick,this)),t=!0),this.setLoader(t),this.loading_active=!0,this.searcher.query({q:s})},this),400)},setLoader:function(t){this.$results.empty().hide(),this.$noresults.removeClass("voog-search-noresults-visible"),t&&this.$loader.show()},unsetLoader:function(){this.$loader.hide()},hideSearch:function(){var t=this.options.visibleClass||"voog-search-visible";o("body").removeClass(t),this.$el.find(".search-box").removeClass("search-box-focus"),o(document).off("click.voog-search-sideclick")},reset:function(){this.$input.data("oldValue","").val(""),this.hideSearch()},handleSearchResult:function(t){this.loading_active=!1,this.pageLinks=t.pages,this.renderContent(t.result),this.unsetLoader(),this.testScroll()},renderContent:function(t){if(t.length){this.$results.show();for(var s=0,e=t.length;s<e;s++){var i=this.options.resultTpl.replace(/\[\[url\]\]/g,t[s].path).replace(/\[\[title\]\]/g,t[s].title).replace(/\[\[content\]\]/g,t[s].description);this.$results.append(o(i))}}else this.$noresults.addClass("voog-search-noresults-visible").empty().append("<div>"+this.options.noResults+"</div>").show()},fetchNextPage:function(){this.loading_active=!0,this.pageLinks.next()},testScroll:function(){this.$content.get(0).offsetHeight===this.$content.get(0).scrollHeight&&!this.loading_active&&this.pageLinks&&this.pageLinks.page<this.pageLinks.total&&this.fetchNextPage()}},window.VoogSearch=t}(jQuery);