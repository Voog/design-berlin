!function(l){function r(a,n,i){var s;return function(){var e=this,t=arguments,o=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||a.apply(e,t)},n),o&&a.apply(e,t)}}l("html").hasClass("no-placeholder")&&l('input[type="text"],textarea').each(function(){l(this).attr("placeholder")&&!l(this).val()&&l(this).val(l(this).attr("placeholder")),l(this).focus(function(){l(this).val()==l(this).attr("placeholder")&&l(this).val("")}).blur(function(){!l(this).val()&&l(this).attr("placeholder")&&l(this).val(l(this).attr("placeholder"))})}),l(".form_fields:not(.edy-fe-fields) select, .custom-select").jqSelect(),l("body:not(.editmode) table").each(function(){l(this).wrap('<div class="table-holder" />')});function e(){var e=l(".site-title:visible");e.is(":empty")&&l(".site-title-editable").appendTo(e)}l("body").hasClass("editmode")&&(e(),l(window).resize(r(e,100)));function d(){.68<=frontPageContentCoverCombinedLightness?l(".js-background-type").addClass("light-background").removeClass("dark-background"):l(".js-background-type").addClass("dark-background").removeClass("light-background")}function o(e,t){return function(o,a){if(o&&a){"string"==typeof o&&(o=o.replace(/rgba?\(/,"").replace(/\)/,"").split(","),l.each(o,function(e,t){o[e]=+t})),"string"==typeof a&&(a=a.replace(/rgba?\(/,"").replace(/\)/,"").split(","),l.each(a,function(e,t){a[e]=+t})),"object"==typeof o&&o.hasOwnProperty("length")&&3==o.length&&o.push(1),"object"==typeof a&&a.hasOwnProperty("length")&&3==a.length&&a.push(1);var e=[0,0,0,0];return e[3]=1-(1-a[3])*(1-o[3]),0===e[3]&&(e[3]=1e-6),e[0]=Math.min(a[0]*a[3]/e[3]+o[0]*o[3]*(1-a[3])/e[3],255),e[1]=Math.min(a[1]*a[3]/e[3]+o[1]*o[3]*(1-a[3])/e[3],255),e[2]=Math.min(a[2]*a[3]/e[3]+o[2]*o[3]*(1-a[3])/e[3],255),l.map(e,function(e){return Math.floor(e)})}}(e||[255,255,255,1],t||[255,255,255,1])}function t(e){window.edy=window.edy||[],edy.push(["texteditorStyles",{name:e,tagname:"a",attribute:{href:"#"},classname:"custom-btn",toggle:!0}])}var c=function(e,t){e.find(".image_settings").show(),e.removeClass("without-image is-loaded with-error").addClass("with-image not-loaded"),t.removeClass("is-hidden").addClass("is-visible")},g=function(e,t){e=e.closest(".js-content-item-box");e.find(".top-inner").append('<div class="edy-img-drop-area-placeholder">'+t+"</div>"),e.find(".top-inner").attr("style",""),e.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),e.find(".edy-img-drop-area").removeClass("active"),e.find(".image_settings").hide(),e.find(".image_settings-remove--input").val(""),e.find(".image_settings-remove--input").trigger("change"),e.find(".form_field-cms").removeClass("with-input")},m=function(e,t){t=o(e,t);return Math.round((.2126*+t[0]+.7152*+t[1]+.0722*+t[2])/2.55)/100};handleProductImage=function(e,t,a,n){var i=l(".js-buy-btn-content  .partial .edy-buy-button-container").data("product-id"),s=l(".js-product-page-image .image-drop-area");l.ajax({type:"GET",contentType:"application/json",url:"/admin/api/pages/"+t,dataType:"json"}).then(function(t){function o(){n.closest(".content-item-box").find(".edy-img-drop-area-placeholder").length<1&&g(n,e)}a?t.data.item_image?(s.css("background-image","url("+t.data.item_image.url+")"),l(".js-remove-image").css("display","flex")):a.detail.product.image?(l(".image_settings").css("display","flex"),l(".js-remove-image").css("display","none"),l(".edy-img-drop-area-placeholder").remove(),c(s.closest(".js-content-item-box"),s.find(".js-toggle-crop-state")),s.css("background-image","url("+a.detail.product.image.url+")")):u(t.image)?l(".edy-img-drop-area-placeholder").length<1&&g(s,e):(s.css("background-image","url("+t.image.public_url+")"),l(".js-remove-image").css("display","flex")):i?l.ajax({type:"GET",contentType:"application/json",url:"/admin/api/ecommerce/v1/products/"+i+"?include=details",dataType:"json"}).then(function(e){e.image?(l(".image_settings").css("display","flex"),l(".js-remove-image").css("display","none"),l(".edy-img-drop-area-placeholder").remove(),c(s.closest(".js-content-item-box"),s.find(".js-toggle-crop-state")),s.css("background-image","url("+e.image.url+")")):u(t.image)?o():(s.css("background-image","url("+t.image.public_url+")"),l(".js-remove-image").css("display","flex"))}):o()})};var a,n,u=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})};a=l(".js-toggle-image-settings"),n=void 0,a.focus(function(){l(window).keyup(function(e){9==(e.keyCode||e.which)&&n()})});var i=function(){l(".js-image-settings-popover").toggleClass("active")};l(".js-toggle-image-settings").click(function(){i()});window.template=l.extend(window.template||{},{bindCustomTexteditorStyles:t,bindRootItemSettings:function(o){"show_product_related_pages_in_main_menu"in o||(o.show_product_related_pages_in_main_menu=!1),l(".js-root-item-settings-toggle").each(function(e,t){new Edicy.SettingsEditor(t,{menuItems:[{titleI18n:"show_in_main_menu",type:"checkbox",key:"show_product_related_pages_in_main_menu",states:{on:!0,off:!1}}],buttonTitleI18n:"settings",values:o,containerClass:["js-root-item-settings-popover","js-prevent-sideclick"],preview:function(e){!0==!e.show_product_related_pages_in_main_menu?l(".js-menu-item-products").addClass("is-hidden"):l(".js-menu-item-products").removeClass("is-hidden")},commit:function(e){siteData.set("settings_root_item",e)}})})},handleProductImageClick:function(e){l("html").hasClass("editmode")&&l(".product-content .product-image").click(function(){window.open("/admin/ecommerce/products/"+e,"_blank").focus()})}}),window.site=l.extend(window.site||{},{toggleFlags:function(){l(".js-option-toggle-flags").on("click",function(e){e.stopPropagation(),e=!l(this).hasClass("js-flag-disable-btn"),siteData.set("flags_state",e),l(this).toggleClass("js-flag-disable-btn"),l(".js-menu-lang-wrap").toggleClass("flags-enabled flags-disabled")})},initSettingsEditorBtn:function(){window.addEventListener("DOMContentLoaded",function(e){var i=document.querySelector(".edy-next-shadowdom").shadowRoot,s=setInterval(function(){var e,t,o,a,n;i.querySelectorAll('div[class^="toolbar__"]').length&&(e=i.querySelector('div[class^="toolbar-expand"]'),t=i.querySelector('div[class^="toolbar__"]'),o=document.querySelector(".js-layout_settings-btn"),a=i.querySelector('div[class^="toolbar-content-item__"]'),o.className=a.className+" "+o.className,t.insertBefore(o,e),i.querySelector(".js-layout_settings-btn").addEventListener("click",function(e){document.querySelector("body").classList.contains("layout_settings-visible")&&(document.querySelector("div.editor_default").style.display="none"),document.querySelector("body").classList.toggle("layout_settings-visible"),e.stopImmediatePropagation()}),n=function(){var e=l(".js-layout_settings-popover"),t=l(".layout_settings-arrow");768<l(window).width()?(e.css({right:window.innerWidth-o.getBoundingClientRect().right-e.width()/2}),t.css({right:e.width()/2})):(e.css({right:0}),t.css({right:72}))},l(window).resize(r(function(){n()},25)),n(),clearInterval(s))},500);l("body").append(l(".js-layout_settings-popover"))})},frontPageContentCoverBgPreview:function(e,t){var o=l(".js-bgpicker-cover-image").css("background-image"),a=e.imageSizes?function(e,t){for(var o,a=0,n=e.length;a<n;a++){if(e[a].width<t)return o||e[a];o=e[a]}return e[e.length-1]}(e.imageSizes,l(window).width()):null,n=e.image&&""!==e.image?"url("+a.url+")":"none",a=e.imageSizes&&""!==e.imageSizes?e.imageSizes:null,i=e.color&&""!==e.color?e.color:"rgba(0,0,0,0)",s=(e.colorData&&""!==e.colorData&&e.colorData.lightness,l("<img>")),r=l("<canvas>"),e=e.image&&""!==e.image?e.image:null;e?!function(e,t){for(var o=e.length;o--;)if(-1<t.indexOf(e[o].url.trim()))return!0;return!1}(a,o)?(s.attr("src",e.replace(/.*\/(photos|voogstock)/g,"/photos")),s.on("load",function(){ColorExtract.extract(s[0],r[0],function(e){frontPageContentBg.frontPageContentBgImageColor=e.bgColor||"rgba(255,255,255,1)",frontPageContentCoverCombinedLightness=m(frontPageContentBg.frontPageContentBgImageColor,i),d()})})):(frontPageContentBg.frontPageContentBgImageColor=frontPageContentBg.frontPageContentBgImageColor||"rgba(224,210,207,1)",frontPageContentCoverCombinedLightness=m(frontPageContentBg.frontPageContentBgImageColor,i),d()):(frontPageContentBg.frontPageContentBgImageColor="rgba(255,255,255,1)",frontPageContentCoverCombinedLightness=m(frontPageContentBg.frontPageContentBgImageColor,i),d()),l(t).find(".js-bgpicker-cover-image").css({"background-image":n}),l(t).find(".js-bgpicker-cover-color").css({"background-color":i})},frontPageContentCoverBgCommit:function(e,t){var o,a=l.extend(!0,{},e);a.image=e.image||"",a.imageSizes=null==(o=e.imageSizes)||"string"==typeof o&&o.match(/^[\\'"]+$/)?"":o,a.color=e.color||"rgba(255,255,255,0)",a.combinedLightness=frontPageContentCoverCombinedLightness,pageData.set(t,a)},handleFrontPageContentCoverColorScheme:function(e){void 0!==e&&(.6<e?l(".header-wrapper").addClass("light").removeClass("dark"):l(".header-wrapper").addClass("dark").removeClass("light"))},bindContentItemImgDropAreas:function(s,r,d){l(".js-content-item-img-drop-area").each(function(e,t){var a=l(t),i=a.closest(".js-content-item-box"),o=i.find(".image_settings-remove"),n=i.data("item-id"),t=i.data("item-type");i.data("image-type"),new Edicy.CustomData({type:t,id:n}),new Edicy.ImgDropArea(a,{positionable:!1,target_width:2048,placeholder:'<div class="edy-img-drop-area-placeholder">'+s+"</div>",removeBtn:null,change:function(e){var t=i.find(".js-toggle-crop-state");a.removeClass("is-cropped").addClass("not-cropped").css("opacity",.1),e?(c(i,t),l(".js-remove-image").css("display","flex")):(i.find(".image_settings").hide(),i.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),t.addClass("is-hidden").removeClass("is-visible"),i.find(".edy-img-drop-area-placeholder").css("opacity",0));var o=i.data("item-type"),t=i.data("item-id");new Edicy.CustomData({type:o,id:t}).set({[d]:"not-cropped",[r]:e}),i.removeClass("not-loaded with-error").addClass("is-loaded"),i.find(".edy-img-drop-area-placeholder").css("opacity",1),a.css("opacity",1)}});o.on("click",function(){var t=l(this),o=i.data("item-id"),a=i.data("item-type"),n=new Edicy.CustomData({type:a,id:o});n.get({success:function(e){e.item_image?n.remove(r,{success:function(e){n.remove(d,{success:function(e){"article"!==a?handleProductImage(s,o,null,t):g(t,s)}})}}):l.ajax({type:"PUT",contentType:"application/json",url:"/admin/api/pages/"+o,dataType:"json",data:JSON.stringify({image_id:null})}).then(function(e){g(t,s)})}})})})},bindContentItemImageCropToggle:function(a){l(".js-toggle-crop-state").on("click",function(){var e=l(this).closest(".js-content-item-box"),t=e.find(".js-content-item-img-drop-area"),o=e.data("item-id"),e=e.data("item-type"),o=new Edicy.CustomData({type:e,id:o}),t=t.hasClass("is-cropped")?(t.removeClass("is-cropped").addClass("not-cropped"),"not-cropped"):(t.removeClass("not-cropped").addClass("is-cropped"),"is-cropped");o.set(a,t)})},bindProductListeners:function(t,o){document.addEventListener("voog:ecommerce:buttonproductsave",function(e){handleProductImage(t,o,e)})}}),t(),l(".js-data-item").each(function(){l(this).on("change",function(e){var t;t="checkbox"===e.target.type?e.target.checked:e.target.value;var o=e.target.dataset.name,a=e.target.dataset.id,n=e.target.dataset.entity,i=e.target.dataset.reload;("site"==n?new Edicy.CustomData({type:"site"}):new Edicy.CustomData({type:n,id:a})).set({[o]:t},{success:function(){i&&location.reload()}})})}),l(".form_field-cms input").length&&(1<=l(".form_field-cms input").val().length?l(".form_field-cms input").closest(".form_field-cms").addClass("with-input"):l(".form_field-cms input").closest(".form_field-cms").removeClass("with-input")),l(document).ready(function(){l(".form_field-cms input").keyup(function(e){1<=l(this).val().length?l(this).closest(".form_field-cms").addClass("with-input"):l(this).closest(".form_field-cms").removeClass("with-input")})})}(jQuery);